# Asignación de tareas Solución

## Enunciado
El equipo de Principios de Optimización se encuentra realizando un rediseño estructural del curso. Dado el largo trabajo que este rediseño implica, los integrantes del equipo han definido diez responsabilidades que deben ser ejecutadas. Para esto, el equipo debe decidir cuál es la mejor asignación de responsabilidades a los diferentes integrantes del equipo para el periodo intersemestral. 
<br>
<br>
Cada uno de los cinco miembros del equipo está en la capacidad de encargarse de cualquiera de estas diez responsabilidades, sin embargo, debido sus preferencias y habilidades, cada uno ha determinado el tiempo (en horas) que le tomará realizar cada una de las responsabilidades que le pueden ser asignadas. Además, cada uno de ellos cuenta con una disponibilidad horaria de acuerdo con su contrato y sus demás compromisos personales. La información descrita anteriormente se encuentra disponible en la Tabla 1. 

**Tabla 1: Tiempos de realización y disponibilidad (en horas)**

<table class="egt">
    
  <tr>  
    <th></th> 
    <th colspan="5";style="text-align:center">Integrantes</th>
  </tr>
    
  <tr>
    <th style="text-align:center">Responsabilidades</th>
    <th style="text-align:center">1</th>
    <th style="text-align:center">2</th>
    <th style="text-align:center">3</th>
    <th style="text-align:center">4</th>
    <th style="text-align:center">5</th>
  </tr>

  <tr>
    <td style="text-align:left"><i>Diseño parciales</i></td>
    <td style="text-align:center">25</td>
    <td style="text-align:center">75</td>
    <td style="text-align:center">125</td>
    <td style="text-align:center">200</td>
    <td style="text-align:center">250</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño tareas</i></td>
    <td style="text-align:center">75</td>
    <td style="text-align:center">25</td>
    <td style="text-align:center">225</td>
    <td style="text-align:center">250</td>
    <td style="text-align:center">200</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño y grabación videos magistrales</i></td>
    <td style="text-align:center">50</td>
    <td style="text-align:center">125</td>
    <td style="text-align:center">100</td>
    <td style="text-align:center">175</td>
    <td style="text-align:center">225</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño talleres magistrales</i></td>
    <td style="text-align:center">100</td>
    <td style="text-align:center">50</td>
    <td style="text-align:center">250</td>
    <td style="text-align:center">225</td>
    <td style="text-align:center">175</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño jupyter notebooks </i></td>
    <td style="text-align:center">125</td>
    <td style="text-align:center">150</td>
    <td style="text-align:center">25</td>
    <td style="text-align:center">150</td>
    <td style="text-align:center">50</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Grabación videos trabajo asistido</i></td>
    <td style="text-align:center">175</td>
    <td style="text-align:center">175</td>
    <td style="text-align:center">50</td>
    <td style="text-align:center">100</td>
    <td style="text-align:center">75</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Edición videos trabajo asistido </i></td>
    <td style="text-align:center">225</td>
    <td style="text-align:center">200</td>
    <td style="text-align:center">175</td>
    <td style="text-align:center">25</td>
    <td style="text-align:center">150</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño talleres trabajo asistido </i></td>
    <td style="text-align:center">150</td>
    <td style="text-align:center">100</td>
    <td style="text-align:center">75</td>
    <td style="text-align:center">125</td>
    <td style="text-align:center">100</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño y grabación videos PulP </i></td>
    <td style="text-align:center">200</td>
    <td style="text-align:center">225</td>
    <td style="text-align:center">150</td>
    <td style="text-align:center">75</td>
    <td style="text-align:center">50</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Edición videos PulP </i></td>
    <td style="text-align:center">250</td>
    <td style="text-align:center">250</td>
    <td style="text-align:center">200</td>
    <td style="text-align:center">50</td>
    <td style="text-align:center">125</td>
  </tr>
    
  <tr>
    <td style="text-align:right"><b>Disponibilidad </b></td>
    <td style="text-align:center">200</td>
    <td style="text-align:center">150</td>
    <td style="text-align:center">150</td>
    <td style="text-align:center">100</td>
    <td style="text-align:center">75</td>
  </tr>


</table>

<br>
Aparte de hacer un curso agradable y productivo para cada uno de los estudiantes, el equipo del curso se siente motivado y a gusto en el proceso de rediseño. Por lo anterior, cada uno ha definido el índice de preferencia asociado a realizar cada una de las responsabilidades. Este índice se encuentra en una escala de 1 a 10, correspondiendo 1 y 10 a la responsabilidad menos deseada y a la preferida, respectivamente. En la Tabla 2 se presenta esta información. 

**Tabla 2: Preferencias**

<table class="egt">
    
  <tr>  
    <th></th> 
    <th colspan="5";style="text-align:center">Integrantes</th>
  </tr>
    
  <tr>
    <th style="text-align:center">Responsabilidades</th>
    <th style="text-align:center">1</th>
    <th style="text-align:center">2</th>
    <th style="text-align:center">3</th>
    <th style="text-align:center">4</th>
    <th style="text-align:center">5</th>
  </tr>

  <tr>
    <td style="text-align:left"><i>Diseño parciales</i></td>
    <td style="text-align:center">1</td>
    <td style="text-align:center">3</td>
    <td style="text-align:center">5</td>
    <td style="text-align:center">8</td>
    <td style="text-align:center">10</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño tareas</i></td>
    <td style="text-align:center">3</td>
    <td style="text-align:center">1</td>
    <td style="text-align:center">9</td>
    <td style="text-align:center">10</td>
    <td style="text-align:center">8</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño y grabación videos magistrales</i></td>
    <td style="text-align:center">2</td>
    <td style="text-align:center">5</td>
    <td style="text-align:center">4</td>
    <td style="text-align:center">7</td>
    <td style="text-align:center">9</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño talleres magistrales</i></td>
    <td style="text-align:center">4</td>
    <td style="text-align:center">2</td>
    <td style="text-align:center">10</td>
    <td style="text-align:center">9</td>
    <td style="text-align:center">7</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño jupyter notebooks </i></td>
    <td style="text-align:center">5</td>
    <td style="text-align:center">6</td>
    <td style="text-align:center">1</td>
    <td style="text-align:center">6</td>
    <td style="text-align:center">2</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Grabación videos trabajo asistido</i></td>
    <td style="text-align:center">7</td>
    <td style="text-align:center">7</td>
    <td style="text-align:center">2</td>
    <td style="text-align:center">4</td>
    <td style="text-align:center">3</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Edición videos trabajo asistido </i></td>
    <td style="text-align:center">9</td>
    <td style="text-align:center">8</td>
    <td style="text-align:center">7</td>
    <td style="text-align:center">1</td>
    <td style="text-align:center">6</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño talleres trabajo asistido </i></td>
    <td style="text-align:center">6</td>
    <td style="text-align:center">4</td>
    <td style="text-align:center">3</td>
    <td style="text-align:center">5</td>
    <td style="text-align:center">4</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Diseño y grabación videos PulP </i></td>
    <td style="text-align:center">8</td>
    <td style="text-align:center">9</td>
    <td style="text-align:center">6</td>
    <td style="text-align:center">3</td>
    <td style="text-align:center">1</td>
  </tr>
    
  <tr>
    <td style="text-align:left"><i>Edición videos PulP </i></td>
    <td style="text-align:center">10</td>
    <td style="text-align:center">10</td>
    <td style="text-align:center">8</td>
    <td style="text-align:center">2</td>
    <td style="text-align:center">5</td>
  </tr>

</table>

<br>
El equipo de Principios de Optimización le ha pedido a usted que plantee y resuelva un modelo matemático que represente la situación. Para esto usted debe seguir los siguientes pasos: 

## Formulación
**a.** Escriba lo(s) conjunto(s), parámetro(s) y variable(s) de decisión que utilizará en el modelo.</p>

### Conjuntos
- $I$: Integrantes 
- $R$: Responsabilidades 

### Parámetros
- $t_{ir}$: tiempo que le tomaría al integrante $i\in I$ realizar la responsabilidad $r\in R$ 
- $d_{i}$: disponibilidad de tiempo del integrante $i\in I$ 
- $p_{ir}$: preferencia del integrante $i\in I$ por realizar la responsabilidad $r\in R$ 

### Variables de decisión
- $x_{ir}: \begin{cases}1&\text{, si el integrante }i\in I\text{ realiza la responsabilidad }r\in R\text{;}\\ 0 & \text{, d.l.c.}  \end{cases}$ 

### Restricciones
**b.** Escriba la(s) restricción(es) lineal(es) que describe(n) que cada responsabilidad se debe asignar a una persona.  

$$\sum_{i\in I}x_{ir}=1, \forall r\in R;$$ 

**c.** Escriba la(s) restricción(es) lineal(es) que describe(n) que se debe respetar la limitación de tiempo de cada integrante. 

$$\sum_{r\in R}t_{ir}\cdot x_{ir}\le d_i, \forall i\in I;$$ 

### Naturaleza de las variables
**d.** Escriba la(s) restricción(es) que describe(n) matemáticamente el tipo de variable(s) que está utilizando dentro del modelo. 

$$x_{ir}\in\{0,1\},\forall i\in I, r\in R.$$
 

### Función Objetivo
**e.** Escriba la función objetivo. 

$$\text{maximizar}  \sum_{i\in I}\sum_{r\in R}p_{ir}\cdot x_{ir}$$


## Formulación matemática completa

**Conjuntos:**
- $I$: Integrantes 
- $R$: Responsabilidades 

**Parámetros:**
- $t_{ir}$: tiempo que le tomaría al integrante $i\in I$ realizar la responsabilidad $r\in R$ 
- $d_{i}$: disponibilidad de tiempo del integrante $i\in I$ 
- $p_{ir}$: preferencia del integrante $i\in I$ por realizar la responsabilidad $r\in R$ 

**Variables de decisión:**
- $x_{ir}: \begin{cases}1&\text{, si el integrante }i\in I\text{ realiza la responsabilidad }r\in R\text{;}\\ 0 & \text{, d.l.c.}  \end{cases}$

**Modelo:**

$$\text{maximizar}  \sum_{i\in I}\sum_{r\in R}p_{ir}\cdot x_{ir}$$

Sujeto a,
\begin{align*}
\sum_{i\in I}x_{ir}&=1, &&\forall r\in R; &(2)\\
\sum_{r\in R}t_{ir}x_{ir} &\le d_i, &&\forall i\in I; &(3)\\
x_{ir}&\in\{0,1\},&&\forall i\in I, r\in R. &(4)
\end{align*}

La función objetivo (1) maximiza la satisfacción total. La restricción (2) describe que cada responsabilidad se debe asignar a una persona. La restricción (3) describe que se debe respetar la limitación de tiempo de cada integrante. La restricción (4) describe la naturaleza de la variable $x_{ir}$. 

## Implementación
**f.** Resuelva el modelo planteado utilizando la librería de PulP en Python. Reporte sus resultados de una manera amigable.

#se importa la libreria de PulP
import pulp as lp

#-----------------
# Conjuntos
#-----------------
#Integrantes
I=[]
for i in range(1,6):
    I.append(i)

#Responsabilidades
R=["Diseño parciales",
   "Diseño tareas",
   "Diseño y grabación videos magistrales",
   "Diseño talleres magistrales",
   "Diseño jupyter notebooks",
   "Grabación videos trabajo asistido",
   "Edición videos trabajo asistido",
   "Diseño talleres trabajo asistido",
   "Diseño y grabación videos PuLP",
   "Edición videos PuLP"]

# Conjunto con todas las duplas (planta, distribuidor)
I_x_R = [(integrante, responsabilidad) for integrante in I for responsabilidad in R] 

#-----------------
# Parámetros
#-----------------
datosIxR={#(integrante, responsabilidad): [tiempo que le tomaría al integrante i realizar la responsabilidad r, preferencia del integrante i por realizar la responsabilidad r]
    (1,"Diseño parciales"):[25,1],
    (2,"Diseño parciales"):[75,3],
    (3,"Diseño parciales"):[125,5],
    (4,"Diseño parciales"):[200,8],
    (5,"Diseño parciales"):[250,10],
    (1,"Diseño tareas"):[75,3],
    (2,"Diseño tareas"):[25,1],
    (3,"Diseño tareas"):[225,9],
    (4,"Diseño tareas"):[250,10],
    (5,"Diseño tareas"):[200,8],
    (1,"Diseño y grabación videos magistrales"):[50,2],
    (2,"Diseño y grabación videos magistrales"):[125,5],
    (3,"Diseño y grabación videos magistrales"):[100,4],
    (4,"Diseño y grabación videos magistrales"):[175,7],
    (5,"Diseño y grabación videos magistrales"):[225,9],
    (1,"Diseño talleres magistrales"):[100,4],
    (2,"Diseño talleres magistrales"):[50,2],
    (3,"Diseño talleres magistrales"):[250,10],
    (4,"Diseño talleres magistrales"):[225,9],
    (5,"Diseño talleres magistrales"):[175,7],
    (1,"Diseño jupyter notebooks"):[125,5],
    (2,"Diseño jupyter notebooks"):[150,6],
    (3,"Diseño jupyter notebooks"):[25,1],
    (4,"Diseño jupyter notebooks"):[150,6],
    (5,"Diseño jupyter notebooks"):[50,2],
    (1,"Grabación videos trabajo asistido"):[175,7],
    (2,"Grabación videos trabajo asistido"):[175,7],
    (3,"Grabación videos trabajo asistido"):[50,2],
    (4,"Grabación videos trabajo asistido"):[100,4],
    (5,"Grabación videos trabajo asistido"):[75,3],
    (1,"Edición videos trabajo asistido"):[225,9],
    (2,"Edición videos trabajo asistido"):[200,8],
    (3,"Edición videos trabajo asistido"):[175,7],
    (4,"Edición videos trabajo asistido"):[25,1],
    (5,"Edición videos trabajo asistido"):[150,6],
    (1,"Diseño talleres trabajo asistido"):[150,6],
    (2,"Diseño talleres trabajo asistido"):[100,4],
    (3,"Diseño talleres trabajo asistido"):[75,3],
    (4,"Diseño talleres trabajo asistido"):[125,5],
    (5,"Diseño talleres trabajo asistido"):[100,4],
    (1,"Diseño y grabación videos PuLP"):[200,8],
    (2,"Diseño y grabación videos PuLP"):[225,9],
    (3,"Diseño y grabación videos PuLP"):[150,6],
    (4,"Diseño y grabación videos PuLP"):[75,3],
    (5,"Diseño y grabación videos PuLP"):[25,1],
    (1,"Edición videos PuLP"):[250,10],
    (2,"Edición videos PuLP"):[250,10],
    (3,"Edición videos PuLP"):[200,8],
    (4,"Edición videos PuLP"):[50,2],
    (5,"Edición videos PuLP"):[125,5]} 

d={#integrante: disponibilidad de tiempo del integrante i
    1:200,
    2:150,
    3:150,
    4:100,
    5:75}  

#parámetros indexados en los integrantes y las responsabilidades
(t, p)=lp.splitDict(datosIxR)

#-------------------------------------
# Creación del objeto problema en PuLP
#-------------------------------------
#Crea el problema para cargarlo con la instancia 
problema=lp.LpProblem("Asignación",lp.LpMaximize)

#-----------------------------
# Variables de Decisión
#-----------------------------
x=lp.LpVariable.dicts('x',I_x_R,cat='Binary') #1 si el integrante i realiza la responsabilidad r, 0 de lo contrario

#-----------------------------
# Función objetivo
#-----------------------------
#Crea la expresión de maximización de satisfacción
problema+=lp.lpSum(x[i,r]*p[i,r] for i in I for r in R), "Satisfacción Total"

#-----------------------------
# Restricciones
#-----------------------------
#sum(i in I)x_ir = 1 forall r in R
for r in R:
    problema+= lp.lpSum(x[i,r] for i in I) == 1, "Asignación de la responsabilidad "+r   #se asigna cada tarea a una persona

#sum(r in R)x_ir*t_ir <= d_i forall i in I
for i in I:
    problema+= lp.lpSum(x[i,r]*t[i,r] for r in R) <= d[i], "Disponibilidad del integrante "+str(i)  #se respeta la disponibilidad de horas que tiene cada integrante
    
#-----------------------------
# Imprimir formato LP
#-----------------------------
#Escribe el problema en un archivo con formato LP 
problema.writeLP("Asignacion.lp")

#-----------------------------
# Invocar el optimizador
#-----------------------------
#Optimizar el modelo con CBC (default de PuLP)
problema.solve()

#-----------------------------
#    Imprimir resultados
#-----------------------------
#Imprimir estado final del optimizador
print("Estado (optimizador):", lp.LpStatus[problema.status],end='\n')

#Valor óptimo del portafolio de Petroco    
print("\nAsignación - \033[1m Satisfacción total \033[0m = ", round(lp.value(problema.objective),2))
print()

#Asignación de tareas   
xSol={i:[r for r in R if x[i,r].value()>0.5] for i in I}
xSol

print()
print('\033[4m'"Asignación de responsabilidades"'\033[0m')
for i in range(1,5):
    print()
    print('\033[1m'+str(i)+":"'\033[0m')
    for j in range(0,len(xSol[i])):
        print(xSol[i][j])


## Créditos

Desarrollo: Juan Felipe Rengifo M<br>
Fecha: 20/09/2020